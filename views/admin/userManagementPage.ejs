<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>Admin Demo</title>
    <!-- plugins:css -->
    <link
      rel="stylesheet"
      href="/public/assets/vendors/mdi/css/materialdesignicons.min.css"
    />
    <link
      rel="stylesheet"
      href="/public/assets/vendors/css/vendor.bundle.base.css"
    />
    <!-- endinject -->
    <!-- Plugin css for this page -->
    <!-- End Plugin css for this page -->
    <!-- inject:css -->
    <!-- endinject -->
    <!-- Layout styles -->
    <link rel="stylesheet" href="/public/assets/css/style.css" />
    <!-- End layout styles -->
    <link rel="shortcut icon" href="/public/assets/images/favicon.png" />
  </head>
  <body>
    <div class="container-scroller">
      <!-- partial:partials/_sidebar.ejs -->
      <%- include('partials/_sidebar') %>
      <!-- partial -->
      <div class="container-fluid page-body-wrapper">
        <!-- partial:partials/_navbar.ejs -->
        <%- include('partials/_navbar') %>
        <!-- partial -->
        <div class="main-panel">
          <div class="content-wrapper">
            <a href="/admin/dashboard">Admin</a>
            >
            <a href="/admin/users">User Management</a>
            <div class="row">
              <div class="col-12 grid-margin">
                <div class="card">
                  <div class="card-body">
                    <h4 class="card-title">User List</h4>
                    <div class="table-responsive">
                      <table class="table">
                        <thead>
                          <tr>
                            <th>First Name</th>
                            <th>Second Name</th>
                            <th>Email</th>
                            <th>Phone No</th>
                            <th>Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          <% users.forEach(user => { %>
                          <tr>
                            <td><%= user.firstName %></td>
                            <td><%= user.lastName %></td>
                            <td><%= user.email %></td>
                            <td><%= user.phoneno %></td>
                            <td>
                              <button
                                class="btn <%= user.isBlocked ? 'btn-success' : 'btn-danger' %>"
                                onclick="confirmAndToggleBlock('<%= user._id %>', '<%= user.isBlocked %>')"
                              >
                                <%= user.isBlocked ? 'Unblock' : 'Block' %>
                              </button>
                            </td>
                          </tr>
                          <% }) %>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- content-wrapper ends -->
          <!-- partial:partials/_footer.ejs -->
          <%- include('partials/_footer') %>
          <!-- partial -->
        </div>
        <!-- main-panel ends -->
      </div>
      <!-- page-body-wrapper ends -->
    </div>
    <!-- container-scroller -->
    <!-- for axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      function confirmAndToggleBlock(userId, isBlocked) {
        const action = isBlocked === "true" ? "unblock" : "block";
        const confirmAction = confirm(
          `Are you sure you want to ${action} this user?`
        );
        if (confirmAction) {
          toggleBlock(userId, isBlocked);
        }
      }

      function toggleBlock(userId, isBlocked) {
        const newStatus = isBlocked === "true" ? false : true;
        axios
          .patch(`/admin/users/block/${userId}`, { isBlocked: newStatus })
          .then((response) => {
            if (response.status === 200) {
              location.reload(); // Reload the page to reflect changes
            } else {
              alert("Failed to update status");
            }
          })
          .catch((error) => {
            console.error("There was an error updating the status!", error);
            alert("Error updating status");
          });
      }
    </script>
    <!-- partial:partials/_scripts.ejs -->
    <%- include('partials/_scripts') %>
    <!-- partial -->
    <!-- Custom JS for toggling block status -->
  </body>
</html>
