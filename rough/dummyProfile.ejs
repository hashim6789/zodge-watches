<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Profile Account</title>
    <%- include('partials/_header') %>
    <style>
      /* Custom styles for the profile page */
      .profile-sidebar {
        width: 100%;
        max-width: 250px; /* Fixed width for sidebar */
        background-color: #f8f9fa; /* Light grey background */
        padding: 15px;
        border-radius: 5px;
      }

      .profile-content {
        background-color: #ffffff; /* White background */
        padding: 15px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
      }

      .nav-link {
        color: #333; /* Dark text color */
      }

      .nav-link:hover,
      .nav-link.active {
        background-color: #e9ecef; /* Lighter background on hover and active state */
        color: #007bff; /* Blue text color */
      }

      .nav-link.active {
        font-weight: bold;
      }
    </style>
    <style>
      .sidebar {
        /* Ensure full height for sidebar */
        height: 100%;
        background-color: #f8f9fa; /* Light grey background */
        border-radius: 5px; /* Rounded corners */
      }

      .sidebar img {
        max-width: 100px; /* Ensure profile image stays within bounds */
      }

      .nav-link {
        color: #333; /* Default link color */
      }

      .nav-link:hover,
      .nav-link.active {
        background-color: #e9ecef; /* Highlight background on hover and active */
        color: #007bff; /* Text color on hover and active */
        font-weight: bold;
      }

      .sidebar .nav-item {
        margin-bottom: 10px; /* Add spacing between nav items */
      }

      .sidebar .nav-link {
        padding: 10px 15px; /* Increase padding for better clickability */
        border-radius: 4px; /* Slight rounding on nav links */
      }
    </style>
  </head>
  <body class="animsition">
    <!-- Header -->
    <%- include('partials/_navbar', { user }) %>

    <!-- Wishlist -->
    <%- include('partials/_wishlist') %>

    <!-- Profile Content -->
    <div class="container mt-5">
      <div class="row">
        <!-- Sidebar Navigation -->
        <div class="col-md-3">
          <div class="sidebar bg-light p-4 rounded shadow-sm">
            <div class="text-center mb-4">
              <img
                class="rounded-circle mb-3"
                src="<%= user.thumbnail %>"
                alt="Profile Picture"
                width="100"
              />
              <h4 class="mb-1"><%= user.firstName %> <%= user.lastName %></h4>
              <p class="text-muted"><%= user.email %></p>
            </div>
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link active" href="#" id="personal-details-link"
                  >Personal Details</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" id="addresses-link">Addresses</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" id="orders-link">Orders</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" id="reset-password-link"
                  >Reset Password</a
                >
              </li>
            </ul>
          </div>
        </div>

        <!-- Main Content Area -->
        <div class="col-md-9">
          <div class="p-3 py-5 bg-white rounded shadow-sm" id="content-area">
            <!-- Personal Details Section -->
            <div id="personal-details">
              <div
                class="d-flex justify-content-between align-items-center mb-3"
              >
                <h4 class="text-primary">Personal Information</h4>
                <button
                  type="button"
                  class="btn btn-outline-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#editPersonalDetailsModal"
                  data-user-id="<%= user._id %>"
                  data-user-first-name="<%= user.firstName %>"
                  data-user-last-name="<%= user.lastName %>"
                >
                  Edit
                </button>
              </div>
              <div class="row mt-2">
                <div class="col-md-6">
                  <label class="form-label">First Name</label>
                  <input
                    type="text"
                    class="form-control"
                    value="<%= user.firstName %>"
                    readonly
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Last Name</label>
                  <input
                    type="text"
                    class="form-control"
                    value="<%= user.lastName %>"
                    readonly
                  />
                </div>
              </div>
              <div class="row mt-3">
                <div class="col-md-12">
                  <label class="form-label">Email</label>
                  <input
                    type="text"
                    class="form-control"
                    value="<%= user.email %>"
                    readonly
                  />
                </div>
                <div class="col-md-12">
                  <label class="form-label">Account Status</label>
                  <input
                    type="text"
                    class="form-control"
                    value="<%= user.isVerified ? 'Verified' : 'Not Verified' %>"
                    readonly
                  />
                </div>
              </div>
            </div>

            <!-- Addresses Section -->
            <div id="addresses" class="d-none">
              <h4 class="text-primary">Addresses</h4>
              <% if (addresses.length === 0) { %>
              <p class="text-muted">No addresses found.</p>
              <% } else { %>
              <div class="list-group">
                <% addresses.forEach(function(address) { %>
                <div
                  class="list-group-item d-flex justify-content-between align-items-center"
                >
                  <div>
                    <h5><%= address.firstName %> <%= address.lastName %></h5>
                    <p>
                      <%= address.addressLine %><br />
                      <%= address.city %>, <%= address.state %>, <%=
                      address.pincode %>, <%= address.flatNo %><br />
                      <%= address.country %><br />
                      <small
                        ><%= address.phoneNo %> <br /><%= address.email
                        %></small
                      >
                    </p>
                  </div>
                  <button
                    type="button"
                    class="btn btn-outline-primary"
                    data-bs-toggle="modal"
                    data-bs-target="#editAddressModal"
                    data-address-id="<%= address._id %>"
                    data-address-first-name="<%= address.firstName %>"
                    data-address-last-name="<%= address.lastName %>"
                    data-address-line1="<%= address.addressLine %>"
                    data-address-city="<%= address.city %>"
                    data-address-state="<%= address.state %>"
                    data-address-zip="<%= address.pincode %>"
                    data-address-country="<%= address.country %>"
                    data-address-phone="<%= address.phoneNo %>"
                    data-address-flat="<%= address.flatNo %>"
                  >
                    Edit Address
                  </button>
                </div>
                <% }) %>
              </div>
              <% } %>
              <button
                id="createNewAddressBtn"
                class="btn btn-success mt-3"
                data-bs-toggle="modal"
                data-bs-target="#createAddressModal"
              >
                Create New Address
              </button>
            </div>

            <!-- Orders Section -->
            <div id="orders" class="d-none">
              <h4 class="text-primary">Orders</h4>
              <% if (orders.length === 0) { %>
              <p class="text-muted">There are no orders to display.</p>
              <% } else { %>
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Order ID</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Total</th>
                    <th>Details</th>
                  </tr>
                </thead>
                <tbody>
                  <% orders.forEach(order => { %>
                  <tr>
                    <td><%= order._id %></td>
                    <td>
                      <%= new Date(order.createdAt).toLocaleDateString() %>
                    </td>
                    <td><%= order.orderStatus %></td>
                    <td>$<%= order.totalPrice.toFixed(2) %></td>
                    <td>
                      <a
                        href="/user/profile/orders/<%= order._id %>"
                        class="btn btn-info"
                        >View Details</a
                      >
                    </td>
                  </tr>
                  <% }) %>
                </tbody>
              </table>
              <% } %>
            </div>

            <!-- Reset Password Section -->
            <div id="reset-password" class="d-none">
              <h4 class="text-primary">Reset Password</h4>
              <form id="resetPassword">
                <div class="mb-3">
                  <label for="email" class="form-label">Email Address</label>
                  <input
                    type="email"
                    class="form-control"
                    id="email"
                    name="email"
                    value="<%= user.email %>"
                    required
                  />
                </div>
                <button type="submit" class="btn btn-primary">
                  Reset Password
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <%- include('partials/_footer') %>

    <!-- Back to top -->
    <div class="btn-back-to-top" id="myBtn">
      <span class="symbol-btn-back-to-top">
        <i class="zmdi zmdi-chevron-up"></i>
      </span>
    </div>
    <%- include('partials/_scripts') %>

    <script>
      // JavaScript to handle section toggling
      document
        .getElementById("personal-details-link")
        .addEventListener("click", function () {
          document
            .getElementById("personal-details")
            .classList.remove("d-none");
          document.getElementById("addresses").classList.add("d-none");
          document.getElementById("orders").classList.add("d-none");
          document.getElementById("reset-password").classList.add("d-none");
        });

      document
        .getElementById("addresses-link")
        .addEventListener("click", function () {
          document.getElementById("personal-details").classList.add("d-none");
          document.getElementById("addresses").classList.remove("d-none");
          document.getElementById("orders").classList.add("d-none");
          document.getElementById("reset-password").classList.add("d-none");
        });

      document
        .getElementById("orders-link")
        .addEventListener("click", function () {
          document.getElementById("personal-details").classList.add("d-none");
          document.getElementById("addresses").classList.add("d-none");
          document.getElementById("orders").classList.remove("d-none");
          document.getElementById("reset-password").classList.add("d-none");
        });

      document
        .getElementById("reset-password-link")
        .addEventListener("click", function () {
          document.getElementById("personal-details").classList.add("d-none");
          document.getElementById("addresses").classList.add("d-none");
          document.getElementById("orders").classList.add("d-none");
          document.getElementById("reset-password").classList.remove("d-none");
        });
    </script>
  </body>
</html>
