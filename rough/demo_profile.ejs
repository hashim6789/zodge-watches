<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Account Profile</title>
    <%- include('partials/_header') %>
    <!-- Bootstrap CSS -->
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Bootstrap JavaScript -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
  </head>
  <body class="animsition">
    <!-- Header -->
    <%- include('partials/_navbar', { user }) %>

    <!-- Wishlist -->
    <%- include('partials/_wishlist') %>

    <!-- Main Container -->
    <div class="container rounded bg-white mt-5 mb-5">
      <!-- breadcrumb -->
      <div class="container pt-5">
        <div class="bread-crumb flex-w p-l-25 p-r-15 p-t-30 p-lr-0-lg">
          <a href="/user/auth/home" class="stext-109 cl8 hov-cl1 trans-04">
            Home
            <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
          </a>

          <span class="stext-109 cl4"> profile </span>
        </div>
      </div>

      <div class="row">
        <!-- Sidebar Navigation -->
        <div class="col-md-3">
          <div class="sidebar p-4 bg-light rounded">
            <div class="text-center mb-4">
              <img
                class="rounded-circle mb-3"
                src="<%= user.thumbnail %>"
                alt="Profile Picture"
                width="100"
              />
              <h4 class="mb-1"><%= user.firstName %> <%= user.lastName %></h4>
              <p class="text-muted"><%= user.email %></p>
            </div>
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link active" href="#" id="personal-details-link"
                  >Personal Details</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" id="addresses-link">Addresses</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" id="orders-link">Orders</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#" id="forgot-password-link"
                  >Reset Password</a
                >
              </li>
            </ul>
          </div>
        </div>

        <!-- Main Content Area -->
        <div class="col-md-9">
          <div class="p-3 py-5 bg-white rounded shadow-sm" id="content-area">
            <!-- Personal Details Section -->
            <div id="personal-details">
              <div
                class="d-flex justify-content-between align-items-center mb-3"
              >
                <h4 class="text-primary">Personal Information</h4>
                <button
                  type="button"
                  class="btn btn-outline-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#editPersonalDetailsModal"
                  data-user-id="<%= user._id %>"
                  data-user-first-name="<%= user.firstName %>"
                  data-user-last-name="<%= user.lastName %>"
                >
                  Edit
                </button>
              </div>
              <div class="row mt-2">
                <div class="col-md-6">
                  <label class="form-label">First Name</label>
                  <input
                    type="text"
                    class="form-control"
                    value="<%= user.firstName %>"
                    readonly
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Last Name</label>
                  <input
                    type="text"
                    class="form-control"
                    value="<%= user.lastName %>"
                    readonly
                  />
                </div>
              </div>
              <div class="row mt-3">
                <div class="col-md-12">
                  <label class="form-label">Email</label>
                  <input
                    type="text"
                    class="form-control"
                    value="<%= user.email %>"
                    readonly
                  />
                </div>
                <div class="col-md-12">
                  <label class="form-label">Account Status</label>
                  <input
                    type="text"
                    class="form-control"
                    value="<%= user.isVerified ? 'Verified' : 'Not Verified' %>"
                    readonly
                  />
                </div>
              </div>
            </div>

            <!-- Addresses Section -->
            <div id="addresses" class="d-none">
              <h4 class="text-primary">Addresses</h4>
              <% if (addresses.length === 0) { %>
              <p class="text-muted">No addresses found.</p>
              <% } else { %>
              <div class="list-group">
                <% addresses.forEach(function(address) { %>
                <div
                  class="list-group-item d-flex justify-content-between align-items-center"
                >
                  <div>
                    <h5><%= address.firstName %> <%= address.lastName %></h5>
                    <p>
                      <%= address.addressLine %><br /><%= address.city %>, <%=
                      address.state %>, <%= address.pincode %>, <%=
                      address.flatNo %><br /><%= address.country %><br /><small
                        ><%= address.phoneNo %> <br /><%= address.email
                        %></small
                      >
                    </p>
                  </div>
                  <button
                    type="button"
                    class="btn btn-outline-primary"
                    data-bs-toggle="modal"
                    data-bs-target="#editAddressModal"
                    data-address-id="<%= address._id %>"
                    data-address-first-name="<%= address.firstName %>"
                    data-address-last-name="<%= address.lastName %>"
                    data-address-line1="<%= address.addressLine %>"
                    data-address-city="<%= address.city %>"
                    data-address-state="<%= address.state %>"
                    data-address-zip="<%= address.pincode %>"
                    data-address-country="<%= address.country %>"
                    data-address-phone="<%= address.phoneNo %>"
                    data-address-flat="<%= address.flatNo %>"
                  >
                    Edit Address
                  </button>
                </div>
                <% }) %>
              </div>
              <% } %>

              <button
                id="createNewAddressBtn"
                class="btn btn-success mt-3"
                data-bs-toggle="modal"
                data-bs-target="#createAddressModal"
              >
                Create New Address
              </button>
            </div>

            <!-- Orders Section (Hidden Initially) -->
            <div id="orders" class="d-none">
              <h4 class="text-primary">Orders</h4>
              <% if (orders.length === 0) { %>
              <p class="text-muted">There are no orders to display.</p>
              <% } else { %>
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Order ID</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Total</th>
                    <th>Details</th>
                  </tr>
                </thead>
                <tbody>
                  <% orders.forEach(order => { %>
                  <tr>
                    <td><%= order._id %></td>
                    <td>
                      <%= new Date(order.createdAt).toLocaleDateString() %>
                    </td>
                    <td><%= order.orderStatus %></td>
                    <td>$<%= order.totalPrice.toFixed(2) %></td>
                    <td>
                      <a
                        href="/user/profile/orders/<%= order._id %>"
                        class="btn btn-info"
                        >View Details</a
                      >
                    </td>
                  </tr>
                  <% }) %>
                </tbody>
              </table>
              <% } %>
            </div>

            <!-- Forgot Password Section (Hidden Initially) -->
            <div id="forgot-password" class="d-none">
              <h4 class="text-primary">Reset Password</h4>
              <form id="resetPassword">
                <div class="mb-3">
                  <label for="email" class="form-label">Email Address</label>
                  <input
                    type="email"
                    class="form-control"
                    id="email"
                    name="email"
                    value="<%= user.email %>"
                    required
                  />
                </div>
                <button type="submit" class="btn btn-primary">
                  Reset Password
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Create New Address Modal -->
    <div
      class="modal fade"
      id="createAddressModal"
      tabindex="-1"
      aria-labelledby="createAddressModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="createAddressModalLabel">
              Create New Address
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="createAddress">
              <input
                type="hidden"
                name="userId"
                id="userId"
                value="<%= user._id %>"
              />
              <div class="mb-3">
                <label for="firstName" class="form-label">First Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="firstName"
                  name="firstName"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="secondName" class="form-label">Second Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="secondName"
                  name="secondName"
                />
              </div>
              <div class="mb-3">
                <label for="phoneNo" class="form-label">Phone Number</label>
                <input
                  type="number"
                  class="form-control"
                  id="phoneNo"
                  name="phoneNo"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="addressEmail" class="form-label">Email</label>
                <input
                  type="email"
                  class="form-control"
                  id="addressEmail"
                  name="AddressEmail"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="addressLine" class="form-label">Address Line</label>
                <input
                  type="text"
                  class="form-control"
                  id="addressLine"
                  name="addressLine"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="flatNo" class="form-label">Flat Number</label>
                <input
                  type="text"
                  class="form-control"
                  id="flatNo"
                  name="flatNo"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="city" class="form-label">City</label>
                <input
                  type="text"
                  class="form-control"
                  id="city"
                  name="city"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="state" class="form-label">State</label>
                <input
                  type="text"
                  class="form-control"
                  id="state"
                  name="state"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="pincode" class="form-label">Pincode</label>
                <input
                  type="text"
                  class="form-control"
                  id="pincode"
                  name="pincode"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="country" class="form-label">Country</label>
                <input
                  type="text"
                  class="form-control"
                  id="country"
                  name="country"
                  required
                />
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  Close
                </button>
                <button type="submit" class="btn btn-primary">
                  Save Address
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <%- include('partials/_footer') %> <%- include('partials/_scripts') %>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Get all elements with data-bs-toggle attribute set to "modal"
        var modalElements = document.querySelectorAll(
          '[data-bs-toggle="modal"]'
        );

        // Attach click event listeners to these elements
        modalElements.forEach(function (element) {
          element.addEventListener("click", function (event) {
            // Get the target modal ID from data-bs-target attribute
            var targetModalId = element.getAttribute("data-bs-target");

            // Get the target modal element
            var targetModal = document.querySelector(targetModalId);

            // Check if the target modal and the data-bs-target attribute are present
            if (targetModal && targetModalId) {
              // Show the target modal
              var bootstrapModal = new bootstrap.Modal(targetModal);
              bootstrapModal.show();
            }
          });
        });
      });

      document.querySelectorAll(".nav-link").forEach((link) => {
        link.addEventListener("click", function () {
          document
            .querySelectorAll(".nav-link")
            .forEach((nav) => nav.classList.remove("active"));
          this.classList.add("active");

          const sections = [
            "personal-details",
            "addresses",
            "orders",
            "forgot-password",
          ];
          sections.forEach((section) =>
            document.getElementById(section).classList.add("d-none")
          );

          switch (this.id) {
            case "personal-details-link":
              document
                .getElementById("personal-details")
                .classList.remove("d-none");
              break;
            case "addresses-link":
              document.getElementById("addresses").classList.remove("d-none");
              break;
            case "orders-link":
              document.getElementById("orders").classList.remove("d-none");
              break;
            case "forgot-password-link":
              document
                .getElementById("forgot-password")
                .classList.remove("d-none");
              break;
          }
        });
      });

      // Modal reset when closed
      $("#createAddressModal").on("hidden.bs.modal", function (e) {
        $(this)
          .find("input,textarea,select")
          .val("")
          .end()
          .find("input[type=checkbox], input[type=radio]")
          .prop("checked", "")
          .end();
      });
    </script>
  </body>
</html>
